#!/bin/sh

LOG=$HOME/.timeclock.log

if [ ! -f $LOG ]; then
	touch $LOG
fi

LINES=$(wc -l $LOG | awk '{print $1}')

if [ -n "$1" ]; then
	if echo $1 | grep -q "start"; then
		if [ "$(( LINES % 2))" -ne 0 ]; then
			echo "already clocked in"
			exit 1
		fi

		echo "clocked in"
		date +%s >> "$LOG"
	elif echo $1 | grep -q "stop"; then
		if [ "$(( LINES % 2))" -eq 0 ]; then
			echo "already clocked out"
			exit 1
		fi

		date +%s >> "$LOG"

		START=$(cat $LOG | tail -2 | head -1)
		END=$(cat $LOG | tail -1)
		DIFF=$(expr "${END}" - "${START}")

		echo "clocked out!"
		echo -n "worked a total of "
		
		h=$(echo "${DIFF}/3600" | bc)
		m=$(echo "(${DIFF}%3600)/60" | bc)
		printf "%01d:%02d\n" $h $m
	else
		echo "unknown command"
		exit 1
	fi
else
	if [ "$(( LINES % 2))" -ne 0 ]; then
		echo "currently on the clock"
	else
		echo "currently clocked out"
	fi
fi